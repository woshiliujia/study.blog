---
title: ES6-12-代理与反射接口
date: 2019-11-01 10:52:21
tags: ES6
categories: ES6
---

代理是一种封装，拦截并改变JS引擎的底层操作


## 代理与反射是什么
通过 new Proxy() 可以创建一个代理用来代替另外一个对象（称为目标）。该代理与目标可以看成是一个对象。
代理可以允许你拦截目标上的底层操作。拦截的行为在代理对象上使用特定的操作函数（被称为陷阱）

目标：被代理的对象
陷阱：拦截底层操作所执行的方法
Reflect:给操作js底层的方法集合（如：get set has ...） 即有了操作函数即陷阱，在这个陷阱函数中可以判断是进行相对应操作，之后使用反射方法设置属性

PS:每个代理陷阱都有对应的一个反射方法，每个方法都与对应的陷阱函数同名

## 创建一个简单的代理
```
let target = {};
let proxy = new Proxy(target,{});

proxy.name = 'naic';
target.name = 'naic';
//输出相同，此代理不包括任何陷阱函数，即按照默认处理
```

## 使用set陷阱验证属性值
```
let target = {
    name :'liujia'
}
let proxy = new Proxy(target,{
    //设置属性的陷阱方法
    //set方法的反射方法是Reflect.set();的默认行为,并且需要在属性设置完返回true，否则返回false
    set(trapTarget,key,value,receiver){//四个参数分别表示 目标(即被代理的对象)，传入的属性(key)，传入的属性值(value)，发生的对象(即代理对象)

        //忽略已有属性
        if(!trapTarget.hasOwnProperty(key)){ //判断自由属性是否存在
            if(isNaN(value)){//判断设置的属性值是否为number
                throw new TypeError('Property must be Number');
            }

            //进行反射添加属性，即陷阱函数对应的反射方法
            return Reflect.set(trapTarget,key,value,receiver);
        }
    }
})
```